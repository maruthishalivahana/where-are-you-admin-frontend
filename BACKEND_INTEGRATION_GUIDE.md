# Bus Management Frontend - Backend Integration Guide

## ğŸš€ Frontend Setup Complete

**Frontend Server:** Running on `http://localhost:3001/Dashboard/buses`

---

## ğŸ“‹ Data Structure & Field Names

The frontend now uses the **correct backend variable names**:

### Bus Object Structure
```javascript
{
  id: string                    // Auto-generated by backend
  numberPlate: string          // â— Changed from "busNumber" â†’ "numberPlate"
  routeName?: string           // Route name (e.g., "Route 42")
  routeId?: string             // Route ID from backend
  driverId?: string            // Internal driver ID
  driverMemberId?: string      // â— Changed from "driverName" â†’ "driverMemberId" (e.g., "D2001")
  driverName?: string          // Driver display name
  status: "active" | "inactive" // â— Lowercase (not "Active"/"Inactive")
  trackingStatus?: string      // GPS tracking state
  lastSeen?: string            // Last update time
  powerOn?: boolean            // Bus power state
}
```

---

## ğŸ”„ CRUD Operations & API Integration

### 1. **Add New Bus**
**Dialog:** "Add New Bus" Button â†’ Input numberPlate

**Frontend Request:**
```javascript
POST http://localhost:3000/api/buses
Body: {
  "numberPlate": "TS09AB1234"    // âœ… Using correct field name
}
```

**Expected Response:**
```json
{
  "bus": {
    "id": "699c82fd...",
    "numberPlate": "TS09AB1234",
    "status": "inactive",
    "trackingStatus": "stopped"
  }
}
```

---

### 2. **Assign Driver to Bus**
**Dialog:** Click three-dot menu â†’ "Assign Driver" â†’ Enter Driver ID

**Frontend Request:**
```javascript
PUT http://localhost:3000/api/buses/:busId/driver
Body: {
  "memberId": "D2001"    // âœ… Using memberId (not driverName)
}
```

**Expected Response:**
```json
{
  "bus": {
    "id": "699c82fd...",
    "numberPlate": "TS09AB1234",
    "driverId": "699c5e5d...",
    "driverMemberId": "D2001",
    "driverName": "John Doe",
    "status": "inactive"
  }
}
```

---

### 3. **Assign Route to Bus**
**Dialog:** Click three-dot menu â†’ "Assign Route" â†’ Enter Route Name

**Frontend Request:**
```javascript
PUT http://localhost:3000/api/buses/:busId/route
Body: {
  "routeName": "Route 42"    // âœ… Using routeName (not routeId)
}
```

**Expected Response:**
```json
{
  "bus": {
    "id": "699c82fd...",
    "numberPlate": "TS09AB1234",
    "routeId": "699c9b84...",
    "routeName": "Route 42",
    "status": "inactive",
    "trackingStatus": "idle"
  }
}
```

---

### 4. **Update Bus Number Plate**
**Dialog:** Click pencil icon â†’ Edit number plate

**Frontend Request:**
```javascript
PUT http://localhost:3000/api/buses/:busId
Body: {
  "numberPlate": "TS09AB5678"    // âœ… Using numberPlate
}
```

---

### 5. **Delete Bus**
**Dialog:** Click trash icon â†’ Confirm deletion

**Frontend Request:**
```javascript
DELETE http://localhost:3000/api/buses/:busId
```

---

## ğŸ§ª Test Scenarios

### Test with Postman or cURL

**1. Add Bus:**
```bash
curl -X POST http://localhost:3000/api/buses \
  -H "Content-Type: application/json" \
  -d '{"numberPlate":"TS09AB1234"}'
```

**2. Assign Driver (replace BUS_ID):**
```bash
curl -X PUT http://localhost:3000/api/buses/699c82fd3ababdd7d2502190/driver \
  -H "Content-Type: application/json" \
  -d '{"memberId":"D2001"}'
```

**3. Assign Route:**
```bash
curl -X PUT http://localhost:3000/api/buses/699c82fd3ababdd7d2502190/route \
  -H "Content-Type: application/json" \
  -d '{"routeName":"Route 42"}'
```

**4. Delete Bus:**
```bash
curl -X DELETE http://localhost:3000/api/buses/699c82fd3ababdd7d2502190
```

---

## âœ… Validation Rules

| Field | Format | Example | Regex |
|-------|--------|---------|-------|
| **numberPlate** | STATE + YY + LETTERS + DIGITS | TS09AB1234 | `/^[A-Z]{2}\d{2}[A-Z]{2}\d{4}$/` |
| **routeName** | "Route" + space + digits | Route 42 | `/^Route \d+$/` |
| **memberId** | Letter + digits | D2001 | min 2 chars |
| **status** | lowercase | active, inactive | - |

---

## ğŸ”Œ API Base URL Configuration

**File:** `/src/app/Dashboard/buses/page.tsx`

```javascript
// Line 21-26
const API_BASE_URL = "http://localhost:3000"
const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    "Content-Type": "application/json",
  },
})
```

Change `localhost:3000` to your actual backend URL if different.

---

## ğŸ“Š Frontend Features Implemented

âœ… **Automatic Field Name Conversion:**
- `busNumber` â†’ `numberPlate`
- `driverName` (input) â†’ sends `memberId` (API)
- `driverIds are generated locally â†’ driverMemberId in backend

âœ… **Status Formatting:**
- Display: "Active" / "Inactive" (readable)
- API: lowercase "active" / "inactive" (technical)

âœ… **Error Handling:**
- Driver not found â†’ Shows backend error message
- Route not found â†’ Shows backend error message
- Invalid format â†’ Shows format validation error

âœ… **Loading States:**
- Buttons disabled during API calls
- User feedback via alerts

---

## ğŸ› Troubleshooting

| Issue | Solution |
|-------|----------|
| "numberPlate must be in format TS09AB1234" | Check your number plate format (e.g., TS09AB1234, not ABC-1234) |
| "Driver with memberId 'D2001' not found" | Ensure driver exists in backend with that memberId |
| "Route with name 'Route 42' not found" | Ensure route exists in backend with exact name |
| Data not updating | Check Network tab â†’ Verify API response contains data |
| Port 3001 already in use | Kill process: `taskkill /F /IM node.exe` |

---

## ğŸ“ Summary

**What Changed? Why?**
- Changed `busNumber` â†’ `numberPlate` to match backend database schema
- Changed driver assignment from name â†’ `memberId` (unique identifier)
- Changed route assignment from ID â†’ `routeName` (human-readable)
- Status now lowercase (`active`/`inactive`) to match backend

**Testing:**
1. Frontend running on `http://localhost:3001`
2. Backend API on `http://localhost:3000`
3. Use frontend UI to perform CRUD operations
4. Monitor network requests to verify correct field names are sent
5. Or use Postman/cURL to test API directly

